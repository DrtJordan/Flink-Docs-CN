

# 运维
Apache Flink是一个跨无界和有界数据流进行有状态计算的框架。由于许多流应用程序被设计为连续运行，停机时间最少，流处理器必须提供良好的故障恢复，以及在应用程序运行时监视和维护的工具。

Apache Flink将重点放在流处理的操作方面。在这里，我们解释了Flink的故障恢复机制，并介绍了其管理和监督运行中的应用程序的特性。

----

## 7*24小时全天候运行
在分布式系统中，机器和过程故障无处不在。像Flink这样的分布式流处理器必须从故障中恢复，才能24/7地运行流应用程序。显然，这不仅意味着在失败后重新启动应用程序，而且还意味着确保其内部状态保持一致，以便应用程序可以继续处理，就好像失败从未发生过一样。

Flink提供了几个特性来确保应用程序保持运行并保持一致:
 - 一致的检查点:Flink的恢复机制基于应用程序状态的一致检查点。如果出现故障，应用程序将重新启动，并从最新的检查点加载其状态。与可重新设置的流源相结合，这个特性可以保证一次完全的状态一致性。
 - 有效的检查点:如果应用程序保持tb级的状态，那么检查点应用程序的状态可能非常昂贵。Flink可以执行异步和增量检查点，以保持检查点对应用程序的延迟sla的影响非常小。
 - 端到端精确地一次:Flink为特定存储系统提供了事务接收器，可以保证数据只写一次，即使在出现故障的情况下也是如此。
 - 与集群管理器集成:Flink与集群管理器紧密集成，例如Hadoop YARN、Mesos或Kubernetes。当流程失败时，将自动启动一个新流程来接管其工作。
 - 高可用性设置:Flink具有高可用性模式，可以消除所有单点故障。ha模式基于Apache ZooKeeper，这是一种经过实战验证的可靠分布式协调服务。

---

## 更新、迁移、挂起和恢复您的应用程序
需要维护支持关键业务服务的流应用程序。bug需要修复，改进或新特性需要实现。然而，更新有状态流应用程序并不是件小事。通常，不能简单地停止应用程序并重新启动一个固定的或改进的版本，因为不能失去应用程序的状态。

Flink的保存点是一个独特而强大的特性，它解决了有状态应用程序的更新问题和许多其他相关的挑战。保存点是应用程序状态的一致快照，因此非常类似于检查点。然而，与检查点不同的是，保存点需要手动触发，并且在应用程序停止时不会自动删除。保存点可用于启动状态兼容的应用程序并初始化其状态。保存点支持以下特性:

 - 应用程序演进:保存点可用于演进应用程序。应用程序的固定或改进版本可以从应用程序的前一个版本的保存点重新启动。也可以从较早的时间点(假设存在这样的保存点)启动应用程序，以修复有缺陷的版本产生的错误结果。
 - 集群迁移:使用保存点，应用程序可以迁移(或克隆)到不同的集群。
 - Flink版本更新:应用程序可以迁移到新的Flink版本上，使用保存点运行。
 - 应用程序扩展:保存点可用于增加或减少应用程序的并行性。
 - A/B测试和假设场景:应用程序的两个(或多个)不同版本的性能或质量可以通过从相同的保存点开始所有版本进行比较。
 - 暂停和恢复:应用程序可以通过获取保存点并停止它来暂停。在以后的任何时候，应用程序都可以从保存点恢复。
 - 归档:可以对保存点进行归档，以便能够将应用程序的状态重置到较早的时间点。

---

## 监控和控制应用程序
与任何其他服务一样，持续运行的流应用程序需要被监视并集成到操作基础设施中，即。组织的监视和记录服务。监控有助于预测问题并提前做出反应。日志记录使根源分析能够调查故障。最后，控制运行中的应用程序的容易访问的接口是一个重要的特性。
Flink与许多常见的日志记录和监视服务很好地集成，并提供了一个REST API来控制应用程序和查询信息。
 - Web UI: Flink提供了一个用于检查、监视和调试运行中的应用程序的Web UI。它还可以用于提交执行的执行或取消执行。
 - 日志记录:Flink实现了流行的slf4j日志记录接口，并与日志记录框架log4j或logback集成。
 - 度量:Flink具有一个复杂的度量系统，用于收集和报告系统和用户定义的度量。度量可以导出到多个报告器，包括JMX、Ganglia、石墨、普罗米修斯、StatsD、Datadog和Slf4j。
 - REST API: Flink公开了一个REST API来提交一个新应用程序，获取一个正在运行的应用程序的保存点，或者取消一个应用程序。REST API还公开元数据和收集的运行或完成应用程序的指标。


